process_one_sample